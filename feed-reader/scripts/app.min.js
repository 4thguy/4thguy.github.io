"use strict";function Article(a,b){return nextArticleId++,{id:nextArticleId,source:b||"unknown",link:a.link,title:a.title,author:a.author,publishedDate:new Date(a.publishedDate),contentSnippet:a.contentSnippet,originalData:a,lazyInit:Article.prototype.lazyInit}}function locationOfInverse(a,b,c,d,e){d=d||0,e=e||b.length;var f=parseInt(d+(e-d)/2),g=b[f][c],h=a[c];return g===h?f:1>=e-d?g>h?f:f-1:g>h?locationOfInverse(a,b,c,f,e):locationOfInverse(a,b,c,d,f)}function getFirstImageUrlFromHtml(a){var b=a.match("<img(.*)>");if(null!==b){var c=b[0],d=c.match('src="')||"";return c=d.input.substr(d.index+5),d=c.match('"'),c=d.input.substr(0,d.index),c||""}return""}Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)};var nextArticleId=0;Article.prototype.lazyInit=function(){"undefined"==typeof this.styling&&(this.styling={backgroundColor:Please.make_color(),backgroundImage:"url("+getFirstImageUrlFromHtml(this.originalData.content)+")"})},angular.module("4thguy.feedReader",["infinite-scroll"]).service("feedList",function(){function a(){localStorage.setItem("feedList",JSON.stringify(c))}function b(){return JSON.parse(localStorage.getItem("feedList"))}var c=b();return null===c&&(c=["http://feeds.mashable.com/Mashable","http://feeds.wired.com/wired/index"],a()),{add:function(b){c.push(b),a()},remove:function(b){c.remove(b),a()},get:function(){return c}}}).service("sourceFeed",function(){return{}}).service("articleFeed",function(){return[]}).factory("dataStorageManager",["articleFeed","sourceFeed",function(a,b){function c(a){"undefined"==typeof b[a]&&(b[a]={})}function d(a,d){return c(a),"undefined"!=typeof b[a][d]}return{addArticle:function(c,e){if(!d(e,c.link))if(b[e][c.link]=c,0===a.length)a.push(c);else{var f=locationOfInverse(c,a,"publishedDate");a.splice(f+1,0,c)}},removeSource:function(c){"undefined"!=typeof b[c]&&(angular.forEach(b[c],function(b){var c=a.indexOf(b);a.remove(c)}),b[c]={})},isArticleAlreadyListed:d}}]).factory("feedParser",["$timeout","dataStorageManager",function(a,b){var c=function(a){angular.forEach(a.entries,function(c){if(!b.isArticleAlreadyListed(a.feedUrl,c.link)){var d=new Article(c,a.title);b.addArticle(d,a.feedUrl)}})};return{parse:c}}]).constant("feedFetcherConfig",{v:"1.0",num:-1,output:"json",scoring:"h",callback:"JSON_CALLBACK"}).factory("feedFetcher",["$http","feedFetcherConfig","feedParser",function(a,b,c){var d="https://ajax.googleapis.com/ajax/services/feed/load?";return angular.forEach(b,function(a,b){d=d+b+"="+a+"&"}),d+="q=",{fetch:function(b){a.jsonp(d+b).success(function(a){200===a.responseStatus&&c.parse(a.responseData.feed)}).error(function(a){console.log(a)})}}}]).factory("feedFetchAll",["$rootScope","feedList","feedFetcher",function(a,b,c){var d=function(){angular.forEach(b.get(),function(a){c.fetch(a)})};return a.$on("fetchAll",function(){d()}),{fetchAll:d}}]).controller("feedCtrl",["$scope","dataStorageManager","feedFetcher","feedList",function(a,b,c,d){a.feedList=d.get(),a.$on("addFeed",function(b,e){""!==e&&(c.fetch(e),d.add(e)),a.newAddress=""}),a.$on("removeFeed",function(c,e){b.removeSource(a.feedList[e]),d.remove(e)})}]).controller("feedScroller",["$scope","feedList","articleFeed","feedFetchAll",function(a,b,c,d){a.articles=c,a.articleCountLimit=0,d.fetchAll(),a.scrolledToBottom=function(){a.articleCountLimit+=10,a.articleCountLimit>a.articles.length&&(a.articleCountLimit=a.articles.length),a.articleCountLimit<10&&(a.articleCountLimit=10)}}]),angular.module("4thguy.feedReader").constant("feedData",{updateIntervalMinutes:1}).service("feedTimer",["$rootScope","feedData",function(a,b){var c=function(c){var d=b.updateIntervalMinutes;c!==d&&(b.updateIntervalMinutes=c||b.updateIntervalMinutes,a.$broadcast("updateTimerMax",c,d))};return c(30),a.$on("changeUpdateInterval",function(a,b){c(b)}),{data:b,reset:c}}]).service("feedTimeout",["$rootScope","$timeout","feedTimer",function(a,b,c){function d(){f=c.data.updateIntervalMinutes}function e(){f-=1,0>=f&&(d(),a.$broadcast("fetchAll")),a.$broadcast("updateTimer",f),b(function(){e()},6e4)}var f=0;return d(),e(),a.$on("updateTimerMax",function(a,b){f=b>a?0:a-f||0}),{currentTimer:f,timerLength:c.data.updateIntervalMinutes}}]).controller("progressBarCtrl",["$rootScope","$scope","feedTimeout",function(a,b){b.value=1,b.max=30,a.$on("updateTimer",function(a,c){b.value=b.max-c}),a.$on("updateTimerMax",function(a,c){b.max=c})}]).constant("updateIntervals",[{name:"30 minutes",value:30},{name:"1 hour",value:60},{name:"2 hours",value:120}]).controller("updateIntervalCtrl",["$rootScope","$scope","updateIntervals",function(a,b,c){b.options=c,b.selectedOption=c[0],b.$on("selectOption",function(d,e){b.selectedOption=c[e],a.$broadcast("changeUpdateInterval",b.selectedOption.value)})}]);